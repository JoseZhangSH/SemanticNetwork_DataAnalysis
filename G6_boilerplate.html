<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Semantic Network VA</title>
</head>

<body>
    <!-- 引入 G6 -->
    <div id="container"></div>
</body>
<script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.3.11/dist/g6.min.js"></script>


<script>
    const container = document.getElementById('container');
    const width = container.scrollWidth;
    const height = container.scrollHeight || 1280;
    const graph = new G6.Graph({
        container: 'container',
        width,
        height,
        modes: {
            default: ['drag-canvas', 'drag-node', 'zoom-canvas',      
            {
        type: 'tooltip',
        formatText(model) {
          return model.id;
        },
        offset: 10,
      }],
        },
        animate: true,
        layout: {
            type: 'forceAtlas2',
            kr: 30,
            // speed: 10,
            // gravity: 1,
            // maxIteration: 2000,
            // // for rendering after each iteration
            // tick: () => {
            // graph.refreshPositions()
            // },
            preventOverlap: true,
            workerEnabled: true,      // 可选，开启 web-worker
            // gpuEnabled: true          // 可选，开启 GPU 并行计算，G6 4.0 支持
            // kr: 10,
        },
        defaultNode: {
            size: 10,
        },
    });

    const main = async () => {
        // fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/relations.json')
        fetch('https://raw.githubusercontent.com/JoseZhangSH/SemanticNetwork_VA/main/data/04_G6/CCFD_G6_Concept_PWA-Minor.json_276?token=GHSAT0AAAAAABLZIDBBXDUEOTFTWBXGI3S2YPVJX3Q')

            .then((res) => res.json())
            .then((data) => {
                graph.data({
                    nodes: data.nodes,
                    edges: data.edges.map(function (edge, i) {
                        edge.id = 'edge' + i;
                        return Object.assign({}, edge);
                    }),
                });
                graph.render();

                // graph.on('node:dragstart', function (e) {
                //     const forceLayout = graph.get('layoutController').layoutMethods[0];
                //     forceLayout.stop()
                //     // graph.layout();
                //     // refreshDragedNodePosition(e);
                // });
                // graph.on('node:drag', function (e) {
                //     // const forceLayout = graph.get('layoutController').layoutMethods[0];
                //     // forceLayout.execute();
                //     refreshDragedNodePosition(e);
                //     graph.layout()
                // });
                // graph.on('node:dragend', function (e) {
                //     e.item.get('model').fx = null;
                //     e.item.get('model').fy = null;
                // });

                if (typeof window !== 'undefined')
                    window.onresize = () => {
                        if (!graph || graph.get('destroyed')) return;
                        if (!container || !container.scrollWidth || !container.scrollHeight) return;
                        graph.changeSize(container.scrollWidth, container.scrollHeight);
                    };
            });
    }

    function refreshDragedNodePosition(e) {
        const model = e.item.get('model');
        model.fx = e.x;
        model.fy = e.y;
        model.x = e.x;
        model.y = e.y;
    }

    main();
</script>

</html>