<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Semantic Network VA</title>
</head>

<body>
    <!-- 引入 G6 -->
    <div id="container"></div>
</body>
<script src="https://gw.alipayobjects.com/os/lib/antv/g6/4.3.11/dist/g6.min.js"></script>


<script>
    const container = document.getElementById('container');
    const width = container.scrollWidth || 2560;
    const height = container.scrollHeight || 1440;

    const colors = [
        '#5F95FF', // blue
        '#61DDAA',
        '#65789B',
        '#F6BD16',
        '#7262FD',
        '#78D3F8',
        '#9661BC',
        '#F6903D',
        '#008685',
        '#F08BB4',
    ];
    const colorSets = G6.Util.getColorSetsBySubjectColors(colors, '#fff', 'default', '#777');

    const graph = new G6.Graph({
        container: 'container',
        width,
        height,
        modes: {
            default: ['drag-canvas', 'drag-node', 'zoom-canvas',
                // {
                //     type: 'tooltip',
                //     formatText(model) {
                //         return model.id;
                //     },
                //     offset: 10,
                // }
            ],
        },
        animate: true,
        layout: {
            type: 'forceAtlas2',
            kr: 30,
            // speed: 10,
            // gravity: 1,
            // maxIteration: 2000,
            // // for rendering after each iteration
            // tick: () => {
            // graph.refreshPositions()
            // },
            preventOverlap: true,
            workerEnabled: true, // 可选，开启 web-worker
            // gpuEnabled: true          // 可选，开启 GPU 并行计算，G6 4.0 支持
            // kr: 10,
        },
        defaultNode: {
            size: 10,
            style: {
                lineWidth: 2,
                // fillOpacity: 0.5,
            },
            labelCfg: {
                position: 'bottom',
                style: {
                    fill: '#666', // 节点标签文字颜色'
                    fontSize: 12,
                    fontFamily: 'Helvetica',
                    opacity: 1,
                },
            },
        },
        defaultEdge: {
            style: {
                opacity: 0.6,
                stroke: "grey",
                lineWidth: 0.1,
            }
        }
    });

    const main = async () => {
        // fetch('https://gw.alipayobjects.com/os/antvdemo/assets/data/relations.json')
        const response = await fetch(
            'https://raw.githubusercontent.com/JoseZhangSH/SemanticNetwork_VA/main/data/04_Compare/ConceptNetwork_Experiment_G6.json?token=GHSAT0AAAAAABLZIDBA66KXLKLF7NLHOCR2YPX67OQ'
        )
        const data = await response.json();
        const nodes = data.nodes;
        const edges = data.edges;

        console.log(nodes);

        nodes.forEach(node => {
            if (!node.style) {
                node.style = {};
            }
            node.size = Math.pow((node.closeness_centrality * 10), 2) * 5;
            node.label = node.id;
            node.style.fillOpacity = node.picture_naming / 3; 

            switch (node.maincategory) {
                case '动物': {
                    node.style.stroke = '#7262fd';
                    node.style.fill = '#7262fd';
                    break;
                }
                case '植物': {
                    node.style.stroke = '#F08BB4';
                    node.style.fill = '#F08BB4';
                    break;
                }
                case '食物': {
                    node.style.stroke = '#F6903D';
                    node.style.fill = '#F6903D';
                    break;
                }
                case '自然物': {
                    node.style.stroke = '#9661BC';
                    node.style.fill = '#9661BC';
                    break;
                }
                case '人造物': {
                    node.style.stroke = '#008685';
                    node.style.fill = '#008685';
                    break;
                }
                case '交通工具': {
                    node.style.stroke = '#5B8FF9';
                    node.style.fill = '#5B8FF9';
                    break;
                }
            }
        })


        // To Do:
        // 是否做过语义特征分析 - 状态标签
        // Legend
        
        
        graph.data(data); // 加载数据
        graph.render(); // 渲染
    }

    function refreshDragedNodePosition(e) {
        const model = e.item.get('model');
        model.fx = e.x;
        model.fy = e.y;
        model.x = e.x;
        model.y = e.y;
    }

    main();
</script>

</html>